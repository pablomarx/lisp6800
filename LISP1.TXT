 NAM LISP-LOOKUP OPT PAG PAGOBEGAD EQU $03D0CAR EQU 0CDR EQU 2EOI EQU 4* LIB LISPLB* GLOBAL VECTORS ORG $0100EVAL RMB 3READ RMB 3PRINT RMB 3TYPSWT RMB 3GETCEL RMB 3FRECEL RMB 3PUSHX RMB 3POPX RMB 3TOPX RMB 3EVLATM RMB 3SETATM RMB 3 JMP LOOKUPGNXTL RMB 3GFNXTL RMB 3LSTINI RMB 3LSTADD RMB 3LSTAD2 RMB 3LSTEND RMB 3LSTEN0 EQU POPXERREX RMB 3ATMINI RMB 3ISDTPR RMB 3ISATOM RMB 3GETC RMB 3NUMINV RMB 3NUMFRM RMB 3FRMNUM RMB 3PUTSYM RMB 3PUTC RMB 3ERRBRK RMB 3 JMP GETSYMSTKFRG RMB 3GCOL RMB 3PROPSH RMB 3GETCAR RMB 3ISVAR RMB 3PRINR RMB 3* ORG OBEGADSTREQ STX STR2 STX STP2 LDX STR1STE2 STX STP1 LDAA 0,X LDX STP2 CMPA 0,X BNE UNEQ INX TSTA BEQ ISEQ LDAA 0,X INX STX STP2 LDX STP1 INX CMPA 0,X BNE UNEQ INX TSTA BNE STE2*ISEQ LDX STR2 TSTA* RTS*UNEQ LDAA #1 BRA ISEQ*LOOKUP STX NAMPTR STX STR1 LDAB 0,X TBA CMPA #'- BNE LKUNM2 TST 1,X BEQ LKU1LKUNUM INX LDAA 0,X BEQ LKUNM3LKUNM2 CMPA #'0 BLT LKU1 CMPA #'9 BLE LKUNUMLKU1 LDX SYMLST BEQ EOLLKU2 STX LSTPTR LDX CAR,X STX FORM DEX LDX CAR,X CMPB 0,X BNE LKU3 JSR STREQ BEQ LKU4LKU3 LDX LSTPTR LDX CDR,X BNE LKU2*EOL JSR GETCEL LDAA NAMPTR STAA CAR,X LDAA NAMPTR+1 STAA CAR+1,X INX STX FORM JSR GETCEL LDAA FORM STAA CAR,X LDAA FORM+1 STAA CAR+1,X LDAA SYMLST STAA CDR,X LDAA SYMLST+1 STAA CDR+1,X STX SYMLST BRA FOUND*FNDNUM STX FORMLKU4 LDAA NAMPTR CMPA BEGPTR BLO FOUND BHI LKU5 LDAA NAMPTR+1 CMPA BEGPTR+1 BLO FOUNDLKU5 LDX NAMPTR STX SPCPTR*FOUND LDX FORM CPX NILATM BNE FND2 LDX ZEROFND1 STX FORMFND2 RTS*LKUNM3 LDX NAMPTR CLRA SUBB #'- STAB XTMP BEQ LKUNM5 CLRBLKUNM4 CMPA #4 BHI NUMOVR ASLB ROLA ASLB ROLA ASLB ROLA ASLB ROLA ADDB 0,X SUBB #'0LKUNM5 INX TST 0,X BNE LKUNM4*LKUNM6 STAA XTMP2 STAB XTMP2+1 LDX XTMP2 LDAA XTMP BNE LKUNM7* JSR NUMINVLKUNM7 JSR NUMFRM BRA FNDNUM*NUMOVR LDX NAMPTR STX SPCPTR LDX #NMOVMS JSR ERRBRK BRA FND1*IXLIST STX XTMP BSR INLIST BCC IXL2 LDAB #-1 BRA IXLRTIXL2 STX XTMP2 LDAB XTMP2+1 SUBB XTMP+1IXLRT LDX XTMP TSTB RTS*INLIST CMPA 0,X BEQ INLRT INX TST 0,X BNE INLIST SECINLRT RTS*GETSYM CLRB LDAA RSTFLG BNE RETEI2 LDX SPCPTR STX SYMPTR LDAA PEEKC BNE GS2GSNXTC JSR GETCGS2 LDX #BRKLST BSR INLIST BCC GSBRK CMPA #$20 BHI GSNSEP TSTB BNE ENDSYM BRA GSNXTCGSBRK TSTB BNE ENDSYM CMPA #EOI BEQ RETEOI BSR COPYC CMPA #'" BEQ GSQSTR LDAB #2ENDNPK CLRAENDSYM STAA PEEKC CLRA BSR COPYC LDX SYMPTR JMP LOOKUP*RETEOI CLR PEEKCRETEI2 LDX EOIATM STX FORM RTS*GSNSEP TSTB BNE GSANCK LDAB #3GSANST BSR COPYC BRA GSNXTCGSANCK CMPB #3 BEQ GSANST BRA ENDSYM*GSQSTR LDAB #1GSQ2 JSR GETC BSR COPYC CMPA #EOI BEQ ENDSYM CMPA #'" BNE GSQ2 JSR GETC CMPA #'" BNE ENDSYM BSR COPYC BRA GSQ2COPYC LDX SPCPTR CPX ENDPTR BPL CPCBAD STAA 0,X INX STX SPCPTR RTSCPCBAD LDX #NOGCMG JMP ERREX*PSTRNG EQU $AD1EPCRLF EQU $AD24* TABLES, ETC.BRKLST FCC '"()[]' FCB '' FCB EOI FCB 0*NMOVMS FCC 'NUMERIC OVERFLOW' FCB 4NOGCMG FCC 'NO MORE FREE SPACE' FCB 4BEGADR EQU * END